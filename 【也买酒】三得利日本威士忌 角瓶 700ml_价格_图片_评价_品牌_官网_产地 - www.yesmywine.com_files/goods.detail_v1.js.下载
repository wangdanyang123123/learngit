(function(){var k={cookieOption:{domain:".yesmywine.com",expires:365,path:"/"},cookieName:"single_goods_area_name"};$(function(){a();e();j();$("#productComment").checkCommentLazyLoad()});function e(){var n="HK$ ";var m=$("#fcl-saved-price").html();var p=$("#fcl-marketing-price").html();var r=$("#fcl-saved-price_hk").length!=0?$("#fcl-saved-price_hk").html().replace(n,""):0;var o=$("#fcl-marketing-price_hk").length!=0?$("#fcl-marketing-price_hk").html().replace(n,""):0;$("#fcl-cal a").bind("click",function(){q()});$("#fclNum").bind({blur:function(){if(this.value===""){this.value="1"}GoodsDetail.changeGoodsAmount("chg","fclNum");q()},focus:function(){if(this.value===""){this.value="1"}}});$("#fcl-cart").bind("click",function(){YM.page.cart.addGoodsToCartV2({goodsId:$("#hidden-wine-id").val(),goodsNum:$("#hidden-fcl-specification").val()*$("#fclNum").val(),adSource:JsGoodsConfig.source});return false});function q(){if($("#fcl-saved-price_hk").length!=0){$("#fcl-saved-price_hk").html(n+GoodsDetail.priceCalculate(r)($("#fclNum").val()));$("#fcl-marketing-price_hk").html(n+GoodsDetail.priceCalculate(o)($("#fclNum").val()))}$("#fcl-saved-price").html(GoodsDetail.priceCalculate(m)($("#fclNum").val()));$("#fcl-marketing-price").html(GoodsDetail.priceCalculate(p)($("#fclNum").val()))}}function a(){$(".comment-thermostatic").hover(function(){$(this).addClass("thermostatic-on")},function(){$(this).removeClass("thermostatic-on")});$(".comment-fav li").hover(function(){$(this).addClass("on")},function(){$(this).removeClass("on")});if($("#area-selector").size()>0){$("#area-selector").click(function(){b("listDown");GoodsDetail.hideArea("year-selector-child");return false})}if($("#areaLimitFlag").val()==1){$("#chgAmount").css("padding-top","0px")}var m=function(n){var o=JsGoodsConfig.promotionId?f:c;l(o,JsGoodsConfig.goodsId,n,JsGoodsConfig.promotionId);h(n)};if($(".choose-areaName").size()>0){$(".choose-areaName").click(function(){$("#area-selector span").text($(this).html());$("#delivery-warn").hide();b("listDown");m($(this).attr("areaId"));return false})}m(JsGoodsConfig.defaultAreaId);$("#suited-goods-cart").bind("click",function(){YM.page.cart.addGoodsToCartBySingle($("#hidden-suitParent-goodsId").val());return false});$("#wine-box-cart").click(function(){var n="";$(".wine-box-checkbox:checked").each(function(o){if(o==0){n+=this.value}else{n+=","+this.value}});if(n==""){alert("请选择组合商品");return false}n=n+","+$("#hidden-wine-id")[0].value;YM.page.cart.addGoodsToCartBySingle(n);return false});$("#suited-wine-nav a").bind("click",function(){var o=$(this);var n=o.attr("index");$("#suited-wine-nav a").each(function(p){if($(this).attr("index")===n){$(this).addClass("hover")}else{$(this).removeClass("hover")}});$("#suited-wine-nav-detail .xiangqing").each(function(p){if(p.toString()===n){$("#suited-wine-detail-"+p).show()}else{$("#suited-wine-detail-"+p).hide()}});return false});GoodsDetail.calculateBoxesPrice2();if($("#presellTimer").size()>0){$("#presellTimer").bindYMUI("CountDown",{callback:function(){$("#add-to-cart-button").attr("class","kb_buyOff")}})}$(document).delegate("#recommendBuffetChange","click",function(){var o=$("#hidden-wine-id").val();var p=$(this);var n=p.data("startIndex");YM.dataproxy.ajax({type:"POST",url:"getRecommendBuffet.jspa",dataType:"json",data:{goodsId:o,startIndex:n},success:function(q){if(q&&q.flag&&q.flag=="1"&&q.bean){if(q.bean){$("#recommendBuffetGoodsList").html(q.bean.goodsList);p.data("startIndex",q.bean.startIndex);if(q.bean.canNextPage=="0"){p.hide()}easyBuy.repeatSelect()}}else{p.parents(".easyBuy").hide()}}})})}function h(o){var n=$("#hidden-wine-id").val();var m=0;if($("#recommendBuffetChange").size()>0){m=$("#recommendBuffetChange").data("startIndex")}var p=$(".easyBuy");showBuffetPromotion=$(".easyComb",p).length>0?false:true;YM.dataproxy.ajax({type:"POST",url:"/goods/getRecommendBuffetFull.jspa",dataType:"json",data:{areaId:o,goodsId:n,startIndex:m,buffetShowPromotion:showBuffetPromotion},success:function(q){if(q&&q.flag&&q.flag=="1"&&q.bean){if(q.bean.replaceClientContent&&q.bean.replaceClientContent=="1"){$(".easyBuy").html(q.bean.goodsList)}}else{$(".easyBuy").html("")}}})}function g(){if($("#area-selector span").size()>0){if($.trim($("#area-selector span").text())=="选择区域"){$("#delivery-warn").show();YM.page.alert("请选择配送区域");return false}}YM.page.cart.addGoodsToCartV2({goodsId:$("#hidden-wine-id").val(),goodsNum:$("#winenum").val(),adSource:JsGoodsConfig.source});YM.page.goodlist.flyElm($(".jqzoom"));return false}function l(q,n,p,m){var o="/stock/queryGoodsStock.jspa?goodsId="+n;if(p){o+="&areaId="+p}if(m){o+="&promotionId="+m}$.ajax({url:o,dataType:"json",complete:function(){$("#stock-loading").hide()},beforeSend:function(){$("#delivery-tip").hide();$("#stock-loading").show()},success:function(r){q(r,n,p,m)}})}function c(q,o,r,n){$("#sellable-stock").html("").hide();$("#choosed-area-selector").show();$("#proChange1").attr("class","promotionMiddleKeyC");$("#proChange2").attr("class","promotionMiddleKeyD");$("#proChange2")[0].onmouseout=null;if(q.flag==-1){}else{if(q.flag){$("#delivery-tip").html("<b>"+$("#area-selector span").text()+"</b>"+(q.msg||"").replace("预订，","")).show();var m=$("#add-to-cart-button").attr("class");if(m=="btn-sellout"){$("#add-to-cart-button").removeClass("btn-sellout").addClass("btn-add-cart").unbind("click").bind("click",g);$("#add_cart_button_two").unbind("click").bind("click",g)}var p=$("#warned-stock").val();if(p&&q.stockNum&&(parseInt(q.stockNum)>0&&parseInt(q.stockNum)<parseInt(p))){$("#winenum").attr("restCount",q.stockNum);$(".num").html("现货数 : <em>"+q.stockNum+"</em>")}else{$("#winenum").attr("restCount","");$(".num").html("")}}else{$("#delivery-tip").html("<b>"+$("#area-selector span").text()+","+q.msg).show();$("#proChange1").attr("class","promotionMiddleKeyS");$("#add-to-cart-button,#add_cart_button_two").attr("class","btn-sellout").unbind("click").bind("click",function(){GoodsDetail.showGoodsArrivalDialog();return false});$("#winenum").attr("restCount","");$(".num").html("")}}$.cookie(k.cookieName,r,k.cookieOption)}function f(p,n,q,m){$("#choosed-area-selector").show();$("#proChange1").attr("class","promotionMiddleKeyC");$("#proChange2").attr("class","promotionMiddleKeyD");$("#proChange2")[0].onmouseout=null;if(p&&p.flag==-1){}else{if(p){p.stockNum=p.stockNum||0;p.bean=p.bean||0;p.limitEachUser=p.limitEachUser||0;$("#delivery-tip").html("<b>"+$("#area-selector span").text()+"</b>"+(p.msg||"").replace("预订，","")).show();if(p.limitEachUser>0){$("#chgAmount").html("每用户限购"+p.limitEachUser+"件").show();$("#head_limitEachUser").html("每用户限购 <em>"+p.limitEachUser+"</em> 件").show()}else{$("#chgAmount").hide();$("#head_limitEachUser").hide()}if(p.flag==1){$("#winenum").attr("restCount",p.limitEachUser>0?p.limitEachUser:100);var o=JsGoodsConfig.source;$("#add_cart_button_two,#add-to-cart-button").unbind("click");$("#add_cart_button_two,#add-to-cart-button").attr("onClick","javascript:Cart3.addGoodsToChart("+n+",'winenum',"+0+",'"+o+"');");$("#add-to-cart-button").attr("class","btn-sta-rob")}else{$("#winenum").attr("restCount","");$("#delivery-warn").html("<b>"+$("#area-selector span").text()+",暂时无货").show();$("#add-to-cart-button").attr("class","btn-over-rob").removeAttr("onclick").removeAttr("href");$("#add_cart_button_two").removeAttr("onclick").removeAttr("href")}}}}function d(){}function j(){$("#attrDataBox").height(90);$("#attrDataBoxBnt").click(function(){var n=document.getElementById("attrDataBoxBnt");if(n.innerHTML=="精简"){n.className="moreAttrT";n.innerHTML="详细";$("#attrDataBox").height("");var m=$("#attrDataBox").height();$("#attrDataBox").animate({height:m})}else{n.innerHTML="精简";n.className="moreAttr";$("#attrDataBox").animate({height:90})}})}function i(){var m={zoomWidth:280,zoomHeight:360,showEffect:"show",hideEffect:"fadeout",fadeoutSpeed:"slow",title:false};if($("#image_box .jqzoom").length==0){return false}$("#image_box .jqzoom").jqzoom(m);var n={thisUl:$("#catalog ul.imgbox"),btnUp:$("#catalog a.aUp"),btnDown:$("#catalog a.aDown"),thisLi:$("#catalog ul.imgbox li"),thisLiH:105,init:function(){n.thisUl.height(n.thisLi.length*n.thisLiH);n.thisUl.css("marginTop",0);n.scrollTop=0;n.maxsclTop=(n.thisLi.length-3)*n.thisLiH;n.btnUp.bind("click",n.slideTop);n.btnDown.bind("click",n.slideDown);n.btnUp.addClass("disabled");if(n.maxsclTop<=0){n.btnDown.addClass("disabled")}},slideTop:function(){if(n.btnUp.hasClass("disabled")){return}n.btnDown.removeClass("disabled");n.btnUp.unbind("click",n.slideTop);n.scrollTop=n.scrollTop-n.thisLiH;n.thisUl.animate({marginTop:-n.scrollTop},350,function(){n.btnUp.bind("click",n.slideTop);if(n.scrollTop<=0){n.btnUp.addClass("disabled")}});return false},slideDown:function(){if(n.btnDown.hasClass("disabled")){return}n.btnUp.removeClass("disabled");n.btnDown.unbind("click",n.slideDown);n.scrollTop=n.scrollTop+n.thisLiH;n.thisUl.animate({marginTop:-n.scrollTop},350,function(){n.btnDown.bind("click",n.slideDown);if(n.scrollTop>=n.maxsclTop){n.btnDown.addClass("disabled")}});return false}};$(document).ready(function(){n.init()});$("#image_list img:only-child").click(function(){$("#current_img").attr("src",$(this).attr("alt"));$("#current_img").parent().attr("href",$(this).attr("longdesc"))})}function b(n){var m=$("#"+n);m.css("display")=="none"?m.css({top:"28px"}).show():m.hide()}})();var GoodsDetail={addGoodsToCartForPresell:function(){if($("#area-selector span").size()>0){if($.trim($("#area-selector span").text())=="选择区域"){$("#delivery-warn").show();return}}YM.page.cart.addGoodsToCartForPresell($("#hidden-wine-id").val(),$("#winenum").val(),$("#hidden-year-goods-id").val(),JsGoodsConfig.source);this.flyElm();YM.track.trigger("track_addGoodsToCart",{goodsId:$("#hidden-wine-id").val()});return},cartClickEvent:function(){if($("#area-selector span").size()>0){if($.trim($("#area-selector span").text())=="选择区域"){$("#delivery-warn").show();YM.page.alert("请选择配送区域");return}}YM.page.cart.addGoodsToCartV2({goodsId:$("#hidden-wine-id").val(),goodsNum:$("#winenum").val(),adSource:JsGoodsConfig.source});this.flyElm();YM.track.trigger("track_addGoodsToCart",{goodsId:$("#hidden-wine-id").val()});return},flyElm:function(){var a=$("#image_box").find("img");var b=a.clone().css("opacity",0.75);$("body").append(b);b.css({"z-index":9000,display:"block",position:"absolute",top:a.offset().top+"px",left:a.offset().left+"px",width:a.width()+"px",height:a.height()+"px"});b.animate({top:$(".ym-nBar-cart-num").offset().top,left:$(".ym-nBar-cart-num").offset().left,width:20,height:32},"slow",function(){b.remove()})},priceCalculate:function(a){var b=this;return function(c){if(isNaN(a)||isNaN(c)){return"请确认您输入的 为数字"}return b.toHtml(parseFloat(a)*parseInt(c))}},showArea:function(b){var a=$("#"+b);a.css({top:"28px"}).show()},hideArea:function(b){var a=$("#"+b);a.hide()},showSelfAndHideOther:function(b,a){$("#"+b).show();$("#"+a).hide()},changeBackgroundColor:function(){$("#proChange1").removeClass("promotionMiddleKey").addClass("promotionMiddleKeyC");$("#proChange2").removeClass("promotionMiddleKeyN").addClass("promotionMiddleKeyD")},removeBackgroundColor:function(){$("#proChange1").removeClass("promotionMiddleKeyC").addClass("promotionMiddleKey");$("#proChange2").removeClass("promotionMiddleKeyD").addClass("promotionMiddleKeyN")},toHtml:function(b){var c=""+b;var a=c.indexOf(".");if(a<0){return c+".0"}if(a<c.length-2){return c.substring(0,a+2)}return c},calculateBoxesPrice2:function(){var c=parseFloat($("#dev_suit_base_price1").val());var b=parseFloat($("#dev_suit_base_price2").val());var a=$("#dev_suit_base_price1_hk").length!=0?parseFloat($("#dev_suit_base_price1_hk").val()):0;var d=$("#dev_suit_base_price2_hk").length!=0?parseFloat($("#dev_suit_base_price2_hk").val()):0;$(".wine-box-checkbox:checked").each(function(){var f=$(this).attr("price3");if(f){c+=parseFloat(f)}else{c+=parseFloat($(this).attr("price1"))}b+=parseFloat($(this).attr("price2"));var e=parseFloat($(this).attr("price3Hk"));if(e>0){a+=e}else{a+=parseFloat($(this).attr("price1Hk"))}d+=parseFloat($(this).attr("price2Hk"))});$("#box-suit-price").html(GoodsDetail.toHtml(c));$("#box-market-price").html(GoodsDetail.toHtml(b));$("#box-save-price").html(GoodsDetail.toHtml(b-c));if($("#box-suit-price_hk").length!=0){$("#box-suit-price_hk").html("HK$ "+GoodsDetail.toHtml(a));$("#box-save-price_hk").html("HK$ "+GoodsDetail.toHtml(d-a))}},changeTab:function(b,e,f){for(var c=1;c<=f;c++){var d=document.getElementById(b+c);var a=document.getElementById("con_"+b+"_"+c);d.className=c==e?"hover":"";a.style.display=c==e?"block":"none"}},addFavorite:function(a){showLoginDiv(function(){YM.dataproxy.ajax({type:"POST",url:"//www.yesmywine.com/mygoods/collectMyGoodsData.jspa",data:"goodsId="+a,dataType:"json",success:function(b){if(b.flag==0){showLoginDiv("GoodsDetail.addFavorite("+a+")")}else{alert(b.msg)}}})});return false},changeGoodsAmount:function(c,e){var b=$("#"+e);var f=b.attr("restCount");var a=$.trim(b.val());if(a==""){alert("购买数量不能为空！");b.focus();b.select();GoodsDetail.showOrHideGift();return}if(isNaN(a)){alert("数量必须是数字！");b.focus();b.select();GoodsDetail.showOrHideGift();return}var d=parseInt(a,10);if(d<1){alert("数量必须大于0！");GoodsDetail.showOrHideGift("0");return}if(f!=""&&f!=undefined){if(d>f){b.val(f);GoodsDetail.showOrHideGift(f);return}}if(d>10000){return}if(c=="add"){if(f!=""&&f!=undefined){if(d>=f){return}}d=d+1;b.val(d);GoodsDetail.showOrHideGift(d);return}else{if(c=="sub"){d=d-1;if(d<1){return}b.val(d);GoodsDetail.showOrHideGift(d);return}else{if(c=="chg"){if(d<1){b.focus();b.select();return}if(f!=""&&f!=undefined){if(d>=f){b.val(f);return}}GoodsDetail.showOrHideGift(b.val())}else{return}}}return false},showOrHideGift:function(a){if(a!=""||a!="0"){$(".promotionMiddleGiftLQZ dl").each(function(){if($(this).data("require")=="undefined"){return true}if($(this).data("require-upper")!=""){if(a>=$(this).data("require")&&a<=$(this).data("require-upper")){$(this).fadeIn()}else{$(this).fadeOut()}}else{if(a>=$(this).data("require")){$(this).fadeIn()}else{$(this).fadeOut()}}})}},sendPriceReductionInfo:function(a,b){if(!this.validateNotify("price-reduction-notify","t-mail-checkbox","t-mail-id")){return false}var c=[];$("#price-reduction-notify input[type='checkbox']:checked").each(function(){c.push($(this).val())});$.ajax({url:"/notify/priceReductionNotify.jspa",type:"POST",data:{goodsId:a,currentPrice:b,subscribeType:c.join(","),email:$("#t-mail-id").val()},beforeSend:function(){YM.util.dialog.close()},success:function(d){if(d.flag){YM.util.dialog.alert("降价提醒已设置成功")}else{YM.util.dialog.alert("降价提醒设置失败")}},error:function(){YM.util.dialog.alert("降价提醒设置出错了")}});return false},sendGoodsArrivalInfo:function(){if(!this.validateNotify("goods-arrival-notify","t-mail-checkbox2","t-mail-id2")){return false}var a=[];$("#goods-arrival-notify input[type='checkbox']:checked").each(function(){a.push($(this).val())});$.ajax({url:"/notify/goodsArrivalNotify.jspa",type:"POST",data:{goodsId:$("#hidden-wine-id").val(),subscribeType:a.join(","),email:$("#t-mail-id2").val()},beforeSend:function(){YM.util.dialog.close()},success:function(b){if(b.flag){YM.util.dialog.alert("到货通知已设置成功")}else{YM.util.dialog.alert("到货通知设置失败")}},error:function(){YM.util.dialog.alert("到货通知设置出错了")}});return false},validateNotify:function(a,c,b){if($("#"+c).attr("checked")&&!validateEmail($("#"+b).val())){alert("请填写正确的Email");return false}if($("#"+a+" input[type='checkbox']:checked").length===0){alert("请至少选择一种通知方式");return false}return true},showPriceReductionDialog:function(){if(!isLogin()){showLoginDiv("GoodsDetail.showPriceReductionDialog()")}else{YM.page.dialog.show({title:"降价提醒",id:"price-reduction-notify",width:490,height:1000})}return false},showGoodsArrivalDialog:function(){showLoginDiv(function(a){$("#t-mail-id2").val(a.email);YM.page.dialog.show({title:"到货通知",id:"goods-arrival-notify",width:490,height:1000})});return false}};function exchangeRMBHK(b){var a=$("#priceShowType").val();if(a=="1"){$(".rmbPrice").hide();$(".hkPrice").show();$("#priceShowType").val("0");b.html("[一键换算RMB]")}else{$(".rmbPrice").show();$(".hkPrice").hide();$("#priceShowType").val("1");b.html("[一键换算HK$]")}};